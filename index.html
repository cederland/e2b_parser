<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<title>E2B Parser</title>
	<style>
		body {
			width: 100%;
			font-family: roboto, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
		}

		#drop-zone {
			height: 300px;
			width: calc(100% - 16px);
			align-items: center;
			padding: 20px;
			border-width: 4px;
			border-radius: 2px;
			border-color: rgb(136, 136, 136);
			border-style: dashed;
			background-color: rgb(240, 240, 240);
			font-size: 20px;
			color: rgb(136, 136, 136);
			outline: none;
			box-sizing: border-box;
		}

		#drop-zone.dragover {
			border-color: rgb(33, 150, 243);
			background-color: rgb(224, 224, 250);
		}

		#help-text {
			top: 0px;
			left: 0px;
			width: 100%;
			height: 100%;
			display: flex;
			align-items: center;
			justify-content: center;
			pointer-events: none;
		}

		#search-container {
			display: flex;
			align-items: center;
			margin: 20px 0;
		}

		#search-tag {
			width: calc(30% - 20px);
			padding: 10px;
			font-size: 16px;
			box-sizing: border-box;
			resize: none; /* Disable resizing */
		}

		#search-label {
			margin-right: 10px;
			font-size: 16px;
		}
	</style>
	<link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
	<script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
</head>

<body>
	<div id="drop-zone">
		<div id="help-text">Drop a E2B XML file here</div>
	</div>
	<div id="search-container">
		<label id="search-label" for="search-tag">Search Tag:</label>
		<textarea id="search-tag" placeholder="originalText"></textarea>
	</div>
	<div id="table"></div>

	<script>
		const dropZone = document.getElementById('drop-zone');
		const searchTagInput = document.getElementById('search-tag');
		let currentXml = null;
		let currentFileName = '';
		let gridInstance = null; // Store the Grid.js instance

		// Prevent default behaviors for dragover and drop events
		dropZone.addEventListener('dragover', (e) => {
			e.preventDefault();
			dropZone.classList.add('dragover');
		});

		dropZone.addEventListener('dragleave', () => {
			dropZone.classList.remove('dragover');
		});

		dropZone.addEventListener('drop', (e) => {
			e.preventDefault();
			dropZone.classList.remove('dragover');

			// Get the dropped file
			const file = e.dataTransfer.files[0];
			if (file) {
				const reader = new FileReader();
				reader.onload = (event) => {
					const xmlText = event.target.result;
					const xmlParser = new DOMParser();
					currentXml = xmlParser.parseFromString(xmlText, "application/xml");
					currentFileName = file.name;
					const searchTagName = searchTagInput.value || "originalText";
					showTable(currentXml, currentFileName, searchTagName);
				};
				reader.readAsText(file);
			}
		});

		// Update table upon change in search-tag
		searchTagInput.addEventListener('input', () => {
			console.log('Input event triggered');
			if (currentXml) {
				const searchTagName = searchTagInput.value || "originalText";
				showTable(currentXml, currentFileName, searchTagName);
			}
		});

		function showTable(xml, fileName, searchTagName) {
			console.log('showTable called with searchTagName:', searchTagName);
			const elements = xml.documentElement.getElementsByTagName(searchTagName);
console.log('Elements found:', elements);
			const data = Array.from(elements).map(element => {
				const elementName = element.nodeName;
				const text = element.textContent;
				const pathway = getPathway(element);
				return [elementName, text, pathway, fileName];
			});
console.log('Data prepared for table:', data);

			function getPathway(element) {
				let path = [];
				while (element) {
					path.unshift(element.nodeName);
					element = element.parentElement;
				}
				return path.join(" > ");
			}

			const tableContainer = document.getElementById('table');
			tableContainer.innerHTML = ''; // Clear the table container

			 // Destroy the existing Grid.js instance if it exists
			if (gridInstance) {
				gridInstance.destroy();
			}

			// Create a new Grid.js instance and store it
			gridInstance = new gridjs.Grid({
				columns: ['Element', 'Text', 'Pathway', 'File name'],
				data: data // Pass the data to Grid.js
			}).render(tableContainer);
			console.log('Table rendered');
		}
	</script>
</body>

</html>